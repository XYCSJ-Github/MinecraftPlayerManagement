<Window x:Class="g_mpm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="g_mpm - 共享内存服务端" Height="700" Width="1000"
        Closing="Window_Closing">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style TargetType="StatusBar">
            <Setter Property="Background" Value="#007ACC"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <Border Grid.Row="0" Background="#007ACC" Padding="10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🖥️ g_mpm 共享内存服务端" 
                           FontSize="18" 
                           FontWeight="Bold" 
                           Foreground="White"
                           VerticalAlignment="Center"/>
                <!--<TextBlock x:Name="txtStatus" 
                           Text="正在启动..." 
                           FontSize="14" 
                           Foreground="White"
                           Margin="20,0,0,0"
                           VerticalAlignment="Center"/>-->
            </StackPanel>
        </Border>

        <!-- 控制面板 -->
        <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 左侧：连接控制 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="btnInitialize" 
                            Content="自动初始化" 
                            Click="btnInitialize_Click"
                            Background="#4CAF50"
                            Foreground="White"
                            FontWeight="Bold"
                            Width="120"/>

                    <Button x:Name="btnRestartCpp" 
                            Content="重启C++进程"
                            Click="btnRestartCpp_Click"
                            IsEnabled="False"
                            Background="#2196F3"
                            Foreground="White"
                            Width="100"/>

                    <Button x:Name="btnDispose" 
                            Content="停止并清理" 
                            Click="btnDispose_Click"
                            Background="#F44336"
                            Foreground="White"
                            Width="100"/>
                </StackPanel>

                <!-- 中间：状态信息 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="3" Padding="8,5">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <TextBlock Text="📤 已发送:" FontWeight="Bold"/>
                                <TextBlock x:Name="txtSentCount" Text="0" Margin="5,0,0,0" Foreground="Green"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <TextBlock Text="📥 已接收:" FontWeight="Bold"/>
                                <TextBlock x:Name="txtReceivedCount" Text="0" Margin="5,0,0,0" Foreground="Blue"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="⏱️ 运行:" FontWeight="Bold"/>
                                <TextBlock x:Name="txtUptime" Text="00:00:00" Margin="5,0,0,0" Foreground="DarkOrange"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 右侧：测试按钮 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="btnTestPing" 
                            Content="命令测试 " 
                            Click="btnTestPing_Click"
                            IsEnabled="False"
                            Background="#2196F3"
                            Foreground="White"
                            Width="90"/>

                    <Button x:Name="btnTestBatch" 
                            Content="批量测试" 
                            Click="btnTestBatch_Click"
                            IsEnabled="False"
                            Width="80"/>

                    <Button x:Name="btnStopCpp" 
                            Content="停止C++" 
                            Click="btnStopCpp_Click"
                            IsEnabled="False"
                            Background="#FF9800"
                            Foreground="White"
                            Width="80"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 主内容区 -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="3"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧：消息发送区 -->
            <Border Grid.Column="0" BorderBrush="LightGray" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 发送区标题 -->
                    <Border Grid.Row="0" Background="#F5F5F5" Padding="10">
                        <TextBlock Text="📤 发送消息" FontWeight="Bold" FontSize="14"/>
                    </Border>

                    <!-- 消息输入区 -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- 快捷消息按钮 -->
                        <WrapPanel Grid.Row="0" Margin="10,10,10,5">
                            <TextBlock Text="快捷消息:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>

                            <Button Content="ping" 
                                    Click="QuickMessage_Click" 
                                    Tag="ping"
                                    Margin="5,0"
                                    Padding="10,3"
                                    Background="#E3F2FD"/>

                            <Button Content="Hello" 
                                    Click="QuickMessage_Click" 
                                    Tag="Hello from g_mpm Server!"
                                    Margin="5,0"
                                    Padding="10,3"
                                    Background="#E8F5E8"/>

                            <Button Content="查询状态" 
                                    Click="QuickMessage_Click" 
                                    Tag="查询状态"
                                    Margin="5,0"
                                    Padding="10,3"
                                    Background="#FFF3E0"/>

                            <Button Content="测试中文" 
                                    Click="QuickMessage_Click" 
                                    Tag="这是一条测试消息"
                                    Margin="5,0"
                                    Padding="10,3"
                                    Background="#F3E5F5"/>
                        </WrapPanel>

                        <!-- 消息输入框 -->
                        <TextBox Grid.Row="1" 
                                 x:Name="txtMessage" 
                                 Margin="10,0,10,10"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 IsEnabled="False"
                                 FontSize="14"
                                 KeyDown="txtMessage_KeyDown"
                                 TextChanged="txtMessage_TextChanged">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="BorderBrush" Value="LightGray"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Background" Value="#F5F5F5"/>
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>

                    <!-- 发送按钮 -->
                    <Border Grid.Row="2" Background="#F5F5F5" Padding="10">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock x:Name="txtCharCount" Text="0/256" Foreground="Gray" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <Button x:Name="btnSend" 
                                    Content="发送消息 (Enter)" 
                                    Click="btnSend_Click"
                                    IsEnabled="False"
                                    Width="120"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- 分割线 -->
            <Rectangle Grid.Column="1" Fill="LightGray" Width="1"/>

            <!-- 右侧：日志显示区 -->
            <Border Grid.Column="2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="324*"/>
                        <ColumnDefinition Width="175*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 日志标题 -->
                    <Border Grid.Row="0" Background="#F5F5F5" Padding="10" Grid.ColumnSpan="2" Margin="0,0,0,448" Grid.RowSpan="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📝 g_mpm 通信日志" FontWeight="Bold" FontSize="14"/>
                            <Button x:Name="btnClearLog" 
                                    Content="清空日志" 
                                    Click="btnClearLog_Click"
                                    Margin="20,0,0,0"
                                    Padding="8,3"
                                    Background="#9E9E9E"
                                    Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- 日志内容 -->
                    <TextBox Grid.Row="1" 
                             x:Name="txtLog" 
                             Margin="10,10,10,10"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             FontFamily="Consolas"
                             FontSize="12"
                             Background="#1E1E1E"
                             Foreground="#D4D4D4"
                             BorderThickness="0"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto" Grid.ColumnSpan="2"/>

                    <!-- 状态栏 -->
                    <Border Grid.Row="1" Background="#333333" Padding="8" Grid.ColumnSpan="2" Margin="0,448,0,0" Grid.RowSpan="2">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       x:Name="txtTime" 
                                       Foreground="White"
                                       FontSize="11"/>

                            <TextBlock Grid.Column="1" 
                                       x:Name="txtInfo" 
                                       Foreground="#4FC3F7"
                                       FontSize="11"
                                       HorizontalAlignment="Center"/>

                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <TextBlock Text="PID:" 
                                           Foreground="White"
                                           FontSize="11"/>
                                <TextBlock x:Name="txtPid" 
                                           Foreground="White"
                                           FontSize="11"
                                           Margin="5,0,0,0"
                                           FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- 底部：状态信息 -->
        <StatusBar Grid.Row="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>

                <StatusBarItem Grid.Column="0">
                    <TextBlock x:Name="txtConnectionStatus" 
                           Text="🔴 未连接" 
                           Foreground="White"
                           FontWeight="Bold"/>
                </StatusBarItem>

                <StatusBarItem Grid.Column="1">
                    <TextBlock Text="C++进程:" Foreground="White"/>
                </StatusBarItem>

                <StatusBarItem Grid.Column="2">
                    <TextBlock x:Name="txtClientStatus" Text="未启动" Foreground="Yellow" Margin="0,0,0,0" FontWeight="Bold"/>
                </StatusBarItem>

                <StatusBarItem Grid.Column="3">
                    <TextBlock x:Name="txtMessageInfo" 
                           Text="g_mpm 正在启动..." 
                           Foreground="White"
                           Margin="5,0,0,0"
                           FontWeight="Bold"/>
                </StatusBarItem>

            </Grid>
        </StatusBar>
    </Grid>
</Window>